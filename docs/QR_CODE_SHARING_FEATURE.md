# OrcTerm 二维码分享功能

## 功能概述

为主机列表添加了二维码分享功能，支持密码直接包含在二维码中，让其他设备可以通过扫码一键添加主机配置，无需手动输入密码。

## 实现的功能

### 1. 二维码生成 (ServersFragment)
- **位置**: 长按主机列表中的任意主机 → "生成二维码"
- **功能**: 生成包含主机配置信息的二维码
- **二维码内容**: JSON格式的主机配置数据

### 2. 二维码内容格式
```json
{
    "type": "orcterm_host",
    "version": "1.0",
    "alias": "主机别名",
    "hostname": "主机地址",
    "port": 端口号,
    "username": "用户名",
    "auth_type": 认证类型(0=密码, 1=密钥),
    "key_path": "密钥路径(密钥认证时)",
    "os_name": "系统名称(可选)",
    "os_version": "系统版本(可选)",
    "container_engine": "容器引擎(可选)",
    "password": "密码(如果存在)",
    "password_required": false/true
}
```

### 3. 二维码显示功能
- **显示内容**: 二维码图片、主机信息、操作说明
- **操作按钮**:
  - **复制配置JSON**: 复制主机配置到剪贴板
  - **保存二维码图片**: 保存二维码图片到相册

### 4. 扫码添加 (MainActivity)
- **入口**: FAB按钮 → "扫码导入"
- **支持格式**:
  - 现有的 `orcterm://import` 格式
  - 新的 JSON 格式二维码

### 5. 扫码解析逻辑
- **JSON验证**: 验证二维码格式和必要字段
- **重复检查**: 检查主机是否已存在
- **安全处理**: 不在二维码中包含密码，需要用户手动输入

## 安全特性

### 1. 密码处理
- **密码包含**: 二维码现在包含密码信息，无需手动输入
- **可选包含**: 如果主机有密码，则包含在二维码中
- **安全提示**: 当二维码包含密码时显示安全警告
- **向后兼容**: 支持不包含密码的旧格式二维码

### 2. 验证机制
- **格式验证**: 严格的JSON格式验证
- **字段验证**: 必要字段完整性检查
- **重复检测**: 防止添加重复主机

## 技术实现

### 1. 依赖库
```gradle
implementation 'com.google.zxing:core:3.4.1'  // 二维码生成
implementation 'com.google.zxing:android-integration:3.3.0'  // 二维码扫描
```

### 2. 关键方法
- **生成二维码**: `generateQRCode(HostEntity host)`
- **解析二维码**: `handleHostJson(String jsonStr)`
- **保存图片**: `saveQRCodeImage(Bitmap bitmap, String alias)`
- **密码输入**: `showPasswordInputDialog(HostEntity host)`

### 3. 数据库操作
- **检查重复**: 通过 hostname + port + username 组合检查
- **异步保存**: 使用后台线程执行数据库操作
- **UI更新**: 在主线程更新UI状态

## 使用流程

### 分享流程
1. 长按主机列表中的主机
2. 选择"生成二维码"
3. 查看生成的二维码
4. 可选择复制JSON或保存图片
5. 其他设备扫描该二维码

### 扫码添加流程
1. 点击FAB按钮
2. 选择"扫码导入"
3. 扫描二维码
4. 如果二维码包含密码，直接添加
5. 如果二维码不包含密码，提示输入密码后添加
6. 自动添加到主机列表

## 错误处理

### 1. 二维码生成失败
- 显示错误信息
- 提供备用方案（复制JSON）

### 2. 二维码解析失败
- 验证格式错误
- 提供友好的错误提示

### 3. 保存失败
- 检查存储权限
- 提供重试机制

## 兼容性

### 1. 向后兼容
- 保持对现有 `orcterm://import` 格式的支持
- 新格式作为扩展功能

### 2. 版本控制
- JSON中包含 `version` 字段
- 支持未来格式升级

## 文件修改清单

### 新增文件
- `TerminalFragment.java` - 终端页面占位符
- `FilesFragment.java` - 文件页面占位符
- `fragment_terminal.xml` - 终端页面布局
- `fragment_files.xml` - 文件页面布局

### 修改文件
- `ServersFragment.java` - 添加二维码生成功能
- `MainActivity.java` - 添加二维码解析功能
- `activity_main.xml` - 调整ViewPager页面数量

## 总结

这个二维码分享功能提供了便捷的主机配置共享方式，同时保持了良好的安全性和用户体验。用户可以快速分享主机配置，无需手动输入复杂的连接参数。